---
title: "JavaPoet 使用指南"
date: 2025-04-21
categories: [编译时注解]
tags: [JavaPoet, 自定义注解]
---



# 📘 JavaPoet 使用指南

> 最近在尝试使用 java 的自定义注解处理器在编译时做一些  bean copy 操作，发现了一个强大的 Java 源码生成库：JavaPoet。本文将介绍 JavaPoet 的基本用法，并提供一些示例代码。

> JavaPoet 是一个强大的 Java 源码生成库，适用于注解处理器、代码模板自动化等场景。

---

## 📦 引入依赖

### Maven

```xml

<dependency>
    <groupId>com.squareup</groupId>
    <artifactId>javapoet</artifactId>
    <version>1.13.0</version>
</dependency>
```

### Gradle

```groovy
implementation 'com.squareup:javapoet:1.13.0'
```

---

## 🔧 核心类概览

| 类名              | 描述              |
|-----------------|-----------------|
| `JavaFile`      | 代表一个 `.java` 文件 |
| `TypeSpec`      | 表示类、接口、枚举等类型声明  |
| `MethodSpec`    | 表示一个方法          |
| `FieldSpec`     | 表示类字段           |
| `ParameterSpec` | 表示方法参数          |
| `CodeBlock`     | 表示方法体或语句块       |

---

## 🧪 快速示例：生成一个简单类

### 目标代码：

```java
package com.example;

public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello, JavaPoet!");
    }
}
```

### JavaPoet 生成代码：

```java
import com.squareup.javapoet.*;

import javax.lang.model.element.Modifier;
import java.io.IOException;
import java.nio.file.Paths;

public class JavaPoetExample {
    public static void main(String[] args) throws IOException {
        MethodSpec main = MethodSpec.methodBuilder("main")
                .addModifiers(Modifier.PUBLIC, Modifier.STATIC)
                .returns(void.class)
                .addParameter(String[].class, "args")
                .addStatement("$T.out.println($S)", System.class, "Hello, JavaPoet!")
                .build();

        TypeSpec helloWorld = TypeSpec.classBuilder("HelloWorld")
                .addModifiers(Modifier.PUBLIC)
                .addMethod(main)
                .build();

        JavaFile javaFile = JavaFile.builder("com.example", helloWorld)
                .build();

        javaFile.writeTo(Paths.get("./src")); // 输出到 src 目录
    }
}
```

---

## 🧱 构建组件详解

### ✳️ 创建字段（FieldSpec）

```java
FieldSpec field = FieldSpec.builder(String.class, "name", Modifier.PRIVATE)
        .initializer("$S", "JavaPoet")
        .build();
```

### ✳️ 创建构造方法

```java
MethodSpec constructor = MethodSpec.constructorBuilder()
        .addModifiers(Modifier.PUBLIC)
        .addParameter(String.class, "name")
        .addStatement("this.name = name")
        .build();
```

### ✳️ 创建普通方法

```java
MethodSpec method = MethodSpec.methodBuilder("getName")
        .addModifiers(Modifier.PUBLIC)
        .returns(String.class)
        .addStatement("return this.name")
        .build();
```

### ✳️ 添加注解

```java
MethodSpec method = MethodSpec.methodBuilder("toString")
        .addAnnotation(Override.class)
        .addModifiers(Modifier.PUBLIC)
        .returns(String.class)
        .addStatement("return name")
        .build();
```

---

## 💡 占位符说明（字符串格式）

| 占位符  | 含义          |
|------|-------------|
| `$S` | 字符串，会自动加双引号 |
| `$T` | 类型，会自动导入包   |
| `$L` | 字面量（直接输出）   |
| `$N` | 名称（变量、方法等）  |

---

## 📁 输出 Java 文件

```java
JavaFile javaFile = JavaFile.builder("com.example", typeSpec)
        .build();

javaFile.writeTo(Paths.get("src/main/java"));
```

---

## 📚 常见使用场景

- 注解处理器中生成 Java 源码
- 自动生成模板代码（如 Getter/Setter、Builder）
- Android 开发中的 Room、Dagger 等框架
- 编译期代码增强（APT）

---

## 📌 附加：CodeBlock 示例

构建一个自定义语句块：

```java
CodeBlock block = CodeBlock.builder()
        .addStatement("int total = 0")
        .beginControlFlow("for (int i = 0; i < 10; i++)")
        .addStatement("total += i")
        .endControlFlow()
        .build();
```

用于方法体：

```java
MethodSpec method = MethodSpec.methodBuilder("calculateSum")
        .addModifiers(Modifier.PUBLIC)
        .returns(int.class)
        .addCode(block)
        .addStatement("return total")
        .build();
```

---

## ✅ 小贴士

- 使用 `$T` 替代全类名，JavaPoet 自动处理 import
- 多个 `addStatement()` 组合可以构造完整方法体
- `CodeBlock` 支持嵌套语法和复杂逻辑
- `JavaFile.toString()` 可以直接输出源码内容

---

## 🧰 常见问题

### Q: 如何写入文件？

使用 `writeTo(Paths.get(...))` 或 `writeTo(System.out)`。

### Q: 如何避免 import 冲突？

JavaPoet 会自动处理 import，并避免重复。

### Q: 能生成泛型、注解、接口吗？

可以，JavaPoet 支持这些特性，通过 `TypeSpec.interfaceBuilder()`、`addAnnotation()` 等方法实现。
